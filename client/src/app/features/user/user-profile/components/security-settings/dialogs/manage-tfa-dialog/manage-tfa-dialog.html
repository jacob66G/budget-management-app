@if (data.isMfaEnabled) {
  <h2 mat-dialog-title>Turn off Two-Factor Authentication</h2>
  <mat-dialog-content>
    <form [formGroup]="tfaForm" (ngSubmit)="onSubmit()" class="dialog-form" autocomplete="off">
      <p class="dialog-intro">
        To confirm, enter the 6-digit code from the authentication app.
      </p>
      
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Verifcation code</mat-label>
        <input matInput formControlName="code" inputmode="numeric" />
        @if (tfaForm.get('code')?.touched && tfaForm.get('code')?.hasError('required')) {
          <mat-error>Code is required.</mat-error>
        }
      </mat-form-field>

    </form>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button (click)="onCancel()">Cancel</button>
    <button
      mat-flat-button
      color="warn" 
      class="submit-button"
      (click)="onSubmit()"
      [disabled]="tfaForm.invalid || isLoading()">
      @if (!isLoading()) {
        <span>Disable</span>
      } @else {
        <mat-spinner [diameter]="20" />
      }
    </button>
  </mat-dialog-actions>

} @else {
  <h2 mat-dialog-title>Set up Two-Factor Authentication</h2>
  
  <mat-dialog-content>
    @if (isQrLoading()) {
      <div class="qr-loading-container">
        <mat-spinner [diameter]="50"></mat-spinner>
        <p>Generating QR code...</p>
      </div>
    } @else {
      <p class="dialog-intro">
        Step 1: Scan the QR code below using your authentication app.
      </p>
      
      <div class="qr-code-container">
        @if (qrCodeUrl()) {
          <img [src]="qrCodeUrl()" alt="QR Code for 2FA setup">
        } @else {
          <mat-error>The QR code could not be generated.<br> Please try again later.</mat-error>
        }
      </div>

      <p class="dialog-intro">
        Step 2: Enter the 6-digit code generated by the app to complete the setup.
      </p>

      <form [formGroup]="tfaForm" (ngSubmit)="onSubmit()" class="dialog-form" autocomplete="off">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Verification code</mat-label>
          <input matInput formControlName="code" inputmode="numeric" />
          @if (tfaForm.get('code')?.touched && tfaForm.get('code')?.hasError('required')) {
            <mat-error>Code is required.</mat-error>
          }
        </mat-form-field>
      </form>
    }
  </mat-dialog-content>
  
  <mat-dialog-actions>
    <button mat-button (click)="onCancel()">Cancel</button>
    <button
      mat-flat-button
      color="primary"
      class="submit-button"
      (click)="onSubmit()"
      [disabled]="tfaForm.invalid || isLoading() || isQrLoading()">
      @if (!isLoading()) {
        <span>Activate and Save</span>
      } @else {
        <mat-spinner [diameter]="20" />
      }
    </button>
  </mat-dialog-actions>
}
